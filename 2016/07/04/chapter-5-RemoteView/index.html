<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>chapter 5 RemoteViews | keep moving</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="5.1 RemoteViews的应用
(1)RemoteViews表示的是一个view结构，它可以在其他进程中显示。由于它在其他进程中显示，为了能够更新它的界面，RemoteViews提供了一组基础的操作用于跨进程更新它的界面。(2)RemoteViews主要用于通知栏通知和桌面小部件的开发，通知栏通知是通过NotificationManager的notify方法来实现的；桌面小部件是通过AppW">
<meta property="og:type" content="article">
<meta property="og:title" content="chapter 5 RemoteViews">
<meta property="og:url" content="http://yoursite.com/2016/07/04/chapter-5-RemoteView/index.html">
<meta property="og:site_name" content="keep moving">
<meta property="og:description" content="5.1 RemoteViews的应用
(1)RemoteViews表示的是一个view结构，它可以在其他进程中显示。由于它在其他进程中显示，为了能够更新它的界面，RemoteViews提供了一组基础的操作用于跨进程更新它的界面。(2)RemoteViews主要用于通知栏通知和桌面小部件的开发，通知栏通知是通过NotificationManager的notify方法来实现的；桌面小部件是通过AppW">
<meta property="og:updated_time" content="2016-07-04T13:21:20.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="chapter 5 RemoteViews">
<meta name="twitter:description" content="5.1 RemoteViews的应用
(1)RemoteViews表示的是一个view结构，它可以在其他进程中显示。由于它在其他进程中显示，为了能够更新它的界面，RemoteViews提供了一组基础的操作用于跨进程更新它的界面。(2)RemoteViews主要用于通知栏通知和桌面小部件的开发，通知栏通知是通过NotificationManager的notify方法来实现的；桌面小部件是通过AppW">
  
    <link rel="alternate" href="/atom.xml" title="keep moving" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">keep moving</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">当你只有一个目标时，整个世界都会为你让路！</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-chapter-5-RemoteView" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/07/04/chapter-5-RemoteView/" class="article-date">
  <time datetime="2016-07-04T11:40:50.000Z" itemprop="datePublished">2016-07-04</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/读书笔记/">读书笔记</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      chapter 5 RemoteViews
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>5.1 RemoteViews的应用</p>
<p>(1)RemoteViews表示的是一个view结构，它可以在其他进程中显示。由于它在其他进程中显示，为了能够更新它的界面，RemoteViews提供了一组基础的操作用于跨进程更新它的界面。<br>(2)RemoteViews主要用于通知栏通知和桌面小部件的开发，通知栏通知是通过NotificationManager的notify方法来实现的；桌面小部件是通过AppWidgetProvider来实现的，它本质上是一个广播(BroadcastReceiver)。这两者的界面都是运行在SystemServer进程中。<br>(3)RemoteViews在Notification中的应用示例<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">Notification notification = <span class="keyword">new</span> Notification();</span><br><span class="line">notification.icon = R.drawable.ic_launcher;</span><br><span class="line">notification.tickerText = <span class="string">"hello world"</span>;</span><br><span class="line">notification.when = System.currentTimeMillis();</span><br><span class="line">notification.flags = Notification.FLAG_AUTO_CANCEL;</span><br><span class="line">Intent intent = <span class="keyword">new</span> Intent(<span class="keyword">this</span>, DemoActivity_1.class);</span><br><span class="line">intent.putExtra(<span class="string">"sid"</span>, <span class="string">""</span> + sId);</span><br><span class="line">PendingIntent pendingIntent = PendingIntent.getActivity(<span class="keyword">this</span>, <span class="number">0</span>, intent, PendingIntent.FLAG_UPDATE_CURRENT);</span><br><span class="line"></span><br><span class="line">RemoteViews remoteViews = <span class="keyword">new</span> RemoteViews(getPackageName(), R.layout.layout_notification);</span><br><span class="line">remoteViews.setTextViewText(R.id.msg, <span class="string">"chapter_5: "</span> + sId);<span class="comment">//设置textview的显示文本</span></span><br><span class="line">remoteViews.setImageViewResource(R.id.icon, R.drawable.icon1);</span><br><span class="line">PendingIntent openActivity2PendingIntent = PendingIntent.getActivity(<span class="keyword">this</span>, <span class="number">0</span>, <span class="keyword">new</span> Intent(<span class="keyword">this</span>, DemoActivity_2.class), PendingIntent.FLAG_UPDATE_CURRENT);</span><br><span class="line">remoteViews.setOnClickPendingIntent(R.id.open_activity2, openActivity2PendingIntent);</span><br><span class="line"><span class="comment">//给图片添加点击事件</span></span><br><span class="line">notification.contentView = remoteViews;</span><br><span class="line">notification.contentIntent = pendingIntent;</span><br><span class="line">NotificationManager manager = (NotificationManager)getSystemService(Context.NOTIFICATION_SERVICE);</span><br><span class="line">manager.notify(sId, notification);</span><br></pre></td></tr></table></figure></p>
<p>(4)RemoteViews在桌面小部件中的应用<br>1.定义小部件界面；<br>2.定义小部件配置信息：其中updatePeriodMillis定义小工具的自动更新周期，单位为ms。<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span><br><span class="line">&lt;appwidget-provider xmlns:android="http://schemas.android.com/apk/res/android"</span><br><span class="line">    android:initialLayout="@layout/widget"</span><br><span class="line">    android:minHeight="84dp"</span><br><span class="line">    android:minWidth="84dp"</span><br><span class="line">    android:updatePeriodMillis="86400000" &gt;</span><br><span class="line">&lt;/appwidget-provider&gt;</span><br></pre></td></tr></table></figure></p>
<p>3.定义小部件的实现类：书中的示例实现了一个显示一张图片的小部件，每次点击小部件的时候图片就会旋转一周；<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAppWidgetProvider</span> <span class="keyword">extends</span> <span class="title">AppWidgetProvider</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = <span class="string">"MyAppWidgetProvider"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String CLICK_ACTION = <span class="string">"com.ryg.chapter_5.action.CLICK"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyAppWidgetProvider</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onReceive</span><span class="params">(<span class="keyword">final</span> Context context, Intent intent)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onReceive(context, intent);</span><br><span class="line">        Log.i(TAG, <span class="string">"onReceive : action = "</span> + intent.getAction());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 这里判断是自己的action，做自己的事情，比如小工具被点击了要干啥，这里是做一个动画效果</span></span><br><span class="line">        <span class="keyword">if</span> (intent.getAction().equals(CLICK_ACTION)) &#123;</span><br><span class="line">            Toast.makeText(context, <span class="string">"clicked it"</span>, Toast.LENGTH_SHORT).show();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                    Bitmap srcbBitmap = BitmapFactory.decodeResource(context.getResources(), R.drawable.icon1);</span><br><span class="line">                    AppWidgetManager appWidgetManager = AppWidgetManager.getInstance(context);</span><br><span class="line">                    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">37</span>; i++) &#123;</span><br><span class="line">                        <span class="keyword">float</span> degree = (i * <span class="number">10</span>) % <span class="number">360</span>;</span><br><span class="line">                        RemoteViews remoteViews = <span class="keyword">new</span> RemoteViews(context.getPackageName(), R.layout.widget);</span><br><span class="line">                        remoteViews.setImageViewBitmap(R.id.imageView1, rotateBitmap(context, srcbBitmap, degree));</span><br><span class="line">                        Intent intentClick = <span class="keyword">new</span> Intent();</span><br><span class="line">                        intentClick.setAction(CLICK_ACTION);</span><br><span class="line">                        PendingIntent pendingIntent = PendingIntent.getBroadcast(context, <span class="number">0</span>, intentClick, <span class="number">0</span>);</span><br><span class="line">                        remoteViews.setOnClickPendingIntent(R.id.imageView1, pendingIntent);</span><br><span class="line">                        appWidgetManager.updateAppWidget(<span class="keyword">new</span> ComponentName(context, MyAppWidgetProvider.class),remoteViews);</span><br><span class="line">                        SystemClock.sleep(<span class="number">30</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;).start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * 每次窗口小部件被点击更新都调用一次该方法</span><br><span class="line">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onUpdate</span><span class="params">(Context context, AppWidgetManager appWidgetManager, <span class="keyword">int</span>[] appWidgetIds)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onUpdate(context, appWidgetManager, appWidgetIds);</span><br><span class="line">        Log.i(TAG, <span class="string">"onUpdate"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">int</span> counter = appWidgetIds.length;</span><br><span class="line">        Log.i(TAG, <span class="string">"counter = "</span> + counter);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; counter; i++) &#123;</span><br><span class="line">            <span class="keyword">int</span> appWidgetId = appWidgetIds[i];</span><br><span class="line">            onWidgetUpdate(context, appWidgetManager, appWidgetId);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * 窗口小部件更新</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">onWidgetUpdate</span><span class="params">(Context context, AppWidgetManager appWidgeManger, <span class="keyword">int</span> appWidgetId)</span> </span>&#123;</span><br><span class="line">        Log.i(TAG, <span class="string">"appWidgetId = "</span> + appWidgetId);</span><br><span class="line">        RemoteViews remoteViews = <span class="keyword">new</span> RemoteViews(context.getPackageName(), R.layout.widget);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// "窗口小部件"点击事件发送的Intent广播</span></span><br><span class="line">        Intent intentClick = <span class="keyword">new</span> Intent();</span><br><span class="line">        intentClick.setAction(CLICK_ACTION);</span><br><span class="line">        PendingIntent pendingIntent = PendingIntent.getBroadcast(context, <span class="number">0</span>, intentClick, <span class="number">0</span>);</span><br><span class="line">        remoteViews.setOnClickPendingIntent(R.id.imageView1, pendingIntent);</span><br><span class="line">        appWidgeManger.updateAppWidget(appWidgetId, remoteViews);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> Bitmap <span class="title">rotateBitmap</span><span class="params">(Context context, Bitmap srcbBitmap, <span class="keyword">float</span> degree)</span> </span>&#123;</span><br><span class="line">        Matrix matrix = <span class="keyword">new</span> Matrix();</span><br><span class="line">        matrix.reset();</span><br><span class="line">        matrix.setRotate(degree);</span><br><span class="line">        <span class="keyword">return</span> Bitmap.createBitmap(srcbBitmap, <span class="number">0</span>, <span class="number">0</span>, srcbBitmap.getWidth(), srcbBitmap.getHeight(), matrix, <span class="keyword">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>4.在AndroidManifest.xml文件中声明小部件<br>下面的示例中包含了两个action，第一个action用于识别小部件的单击行为，而第二个action是作为小部件必须存在的action android.appwidget.action.APPWIDGET_UPDATE，如果不加那么就无法显示小部件。<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">receiver</span> <span class="attr">android:name</span>=<span class="string">".MyAppWidgetProvider"</span> &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta-data</span></span><br><span class="line">        <span class="attr">android:name</span>=<span class="string">"android.appwidget.provider"</span></span><br><span class="line">        <span class="attr">android:resource</span>=<span class="string">"@xml/appwidget_provider_info"</span> &gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">meta-data</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">"com.ryg.chapter_5.action.CLICK"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">"android.appwidget.action.APPWIDGET_UPDATE"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">receiver</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>(5)AppWidgetProvider会自动根据广播的action通过onReceive方法来自动分发广播，也就是调用下面不同的方法：<br>onEnable：当小部件第一次添加到桌面时调用，小部件可以添加多次但是只在第一次添加的时候调用；<br>onUpdate：小部件被添加时或者每次小部件更新时都会调用一次该方法，每个周期小部件都会自动更新一次；<br>onDeleted：每删除一次小部件就调用一次；<br>onDisabled：当最后一个该类型的小部件被删除时调用该方法；<br>onReceive：这是广播内置的方法，用于分发具体的事件给其他方法，所以该方法一般要调用super.onReceive(context, intent); 如果自定义了其他action的广播，就可以在调用了父类方法之后进行判断，如上面代码所示。<br>(6)PendingIntent表示一种处于Pending状态的Intent，pending表示的是即将发生的意思，它是在将来的某个不确定的时刻放生，而Intent是立刻发生。<br>(7)PendingIntent支持三种待定意图：启动Activity(getActivity)，启动Service(getService)，发送广播(getBroadcast)。<br>PendingIntent.getActivity(Context context, in requestCode, Intent intent, int flags)<br>获得一个PendingIntent，当待定意图发生时，效果相当于Context.startActivity(intent)。<br>第二个参数requestCode是PendingIntent发送方的请求码，多数情况下设为0即可，另外requestCode会影响到flags的效果。<br>PendingIntent的匹配规则：如果两个PendingIntent内部的Intent相同，并且requestCode也相同，那么这两个PendingIntent就是相同的。<br>Intent的匹配规则：如果两个Intent的ComponentName和intent-filter都相同，那么这两个Intent就是相同的，Extras不参与Intent的匹配过程。<br>第四个参数flags常见的类型有：FLAG_ONE_SHOT、FLAG_NO_CREATE、FLAG_CANCEL_CURRENT、FLAG_UPDATE_CURRENT。<br>FLAG_ONE_SHOT：当前描述的PendingIntent只能被调用一次，然后它就会被自动cancel。如果后续还有相同的PendingIntent，那么它们的send方法就会调用失败。对于通知栏消息来说，如果采用这个flag，那么同类的通知只能使用一次，后续的通知单击后将无法打开。<br>FLAG_NO_CREATE：当前描述的PendingIntent不会主动创建，如果当前PendingIntent之前不存在，那么getActivity、getService和getBroadcast方法会直接返回null，即获取PendingIntent失败。这个标志位使用很少。<br>FLAG_CANCEL_CURRENT：当前描述的PendingIntent如果已经存在，那么它们都会被cancel，然后系统会创建一个新的PendingIntent。对于通知栏消息来说，那些被cancel的通知单击后将无法打开。<br>FLAG_UPDATE_CURRENT：当前描述的PendingIntent如果已经存在，那么它们都会被更新，即它们的Intent中的Extras会被替换成最新的。</p>
<p>(8)分析NotificationManager.nofify(id, notification)<br>1.如果参数id是常量，那么多次调用notify只能弹出一个通知，后续的通知会把前面的通知完全替代掉；<br>2.如果参数id每次都不同，那么当PendingIntent不匹配的时候，不管采用何种标志位，这些通知之间不会相互干扰；<br>3.如果参数id每次都不同，且PendingIntent匹配的时候，那就要看标志位：<br>如果标志位是FLAG_ONE_SHOT，那么后续的通知中的PendingIntent会和第一条通知保持完全一致，包括其中的Extras，单击任何一条通知后，剩下的通知均无法再打开，当所有的通知都被清除后，会再次重复这个过程；<br>如果标志位是FLAG_CANCEL_CURRENT，那么只有最新的通知可以打开，之前弹出的所有通知都无法打开；<br>如果标志位是FLAG_UPDATE_CURRENT，那么之前弹出的通知中的PendingIntent会被更新，最终它们和最新的一条通知保持完全一致，包括其中的Extras，并且这些通知都是可以打开的。</p>
<p>5.2 RemoteViews的内部机制</p>
<p>(1)RemoteViews的构造方法 public RemoteViews(String packageName, int layoutId)，第一个参数是当前应用的包名，第二个参数是待加载的布局文件。<br>(2)RemoteViews只支持部分布局和View组件，下面列举的组件的子类是不支持的<br>布局：FrameLayout、LinearLayout、RelativeLayout、GridLayout<br>组件：Button、ImageButton、ImageView、TextView、ListView、GridView、ViewStub等<br>(3)RemoteViews提供了一系列的set方法完成view的设置，这是通过反射完成的调用的。<br>例如方法setInt(int viewId, String methodName, int value)就是反射调用view对象的名称为methodName的方法，传入参数value，同样的还有setBoolean、setLong等。<br>方法setOnClickPendingIntent(int viewId, PendingIntent pi)用来为view添加单击事件，事件类型只能为PendingIntent。<br>(4)通知和小部件分别由NotificationManager和AppWidgetManager管理，而它们通过Binder分别和SystemServer进程中的NotificationManagerService和AppWidgetManagerService进行通信。所以，布局文件实际上是两个Service加载的，运行在SystemServer进程中。<br>(5)RemoteViews实现了Parcelable接口，它会通过Binder传递到SystemServer进程，系统会根据RemoteViews中的包名信息获取到应用中的资源，从而完成布局文件的加载。<br>(6)系统将view操作封装成Action对象，Action同样实现了Parcelable接口，通过Binder传递到SystemServer进程。远程进程通过RemoteViews的apply方法来进行view的更新操作，RemoteViews的apply方法内部则会去遍历所有的action对象并调用它们的apply方法来进行view的更新操作。<br>这样做的好处是不需要定义大量的Binder接口，其次批量执行RemoteViews中的更新操作提高了程序性能。<br>(7)RemoteViews的apply和reapply方法的区别：apply方法会加载布局并更新界面，而reapply方法则只会更新界面。<br>(8)setOnClickPendingIntent、setPendingIntentTemplate和setOnClickFillIntent的区别<br>setOnClickPendingIntent用于给普通的view添加点击事件，但是不能给集合(ListView和StackView)中的view设置点击事件，因为开销太大了。如果需要给ListView和StackView中的item添加点击事件，需要结合setPendingIntentTemplate和setOnClickFillIntent一起使用。[并没有尝试(⊙o⊙)]</p>
<p>5.3 RemoteViews的意义</p>
<p>RemoteViews的最大的意义是实现了跨进程的UI更新，这节作者实现了一个模拟通知栏效果的应用来演示跨进程的UI更新，源码传送门。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/07/04/chapter-5-RemoteView/" data-id="ciqqn7riv0003l69kbw2fe1d4" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/android/">android</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2016/07/17/单例模式/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          单例模式
        
      </div>
    </a>
  
  
    <a href="/2016/06/28/learn more study less 读书笔记/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">learn more study less 读书笔记</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/android/">android</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/学习感悟/">学习感悟</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/学习方法/">学习方法</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/设计模式/">设计模式</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/读书笔记/">读书笔记</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/android/">android</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/学习感悟/">学习感悟</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/学习方法/">学习方法</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/设计模式/">设计模式</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/android/" style="font-size: 20px;">android</a> <a href="/tags/学习感悟/" style="font-size: 10px;">学习感悟</a> <a href="/tags/学习方法/" style="font-size: 10px;">学习方法</a> <a href="/tags/设计模式/" style="font-size: 20px;">设计模式</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/">July 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/06/">June 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">May 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/">March 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/01/">January 2015</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2016/07/17/单例模式/">单例模式</a>
          </li>
        
          <li>
            <a href="/2016/07/04/chapter-5-RemoteView/">chapter 5 RemoteViews</a>
          </li>
        
          <li>
            <a href="/2016/06/28/learn more study less 读书笔记/">learn more study less 读书笔记</a>
          </li>
        
          <li>
            <a href="/2016/06/21/feynman_technique/">feynman_technique</a>
          </li>
        
          <li>
            <a href="/2016/05/05/GRADLE构建最佳实践/">GRADLE构建最佳实践</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2016 parkerzhou<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>